	ORG	 0x0
V0:	WORD	$DEFAULT, 0x180
V1:	WORD	$INT1, 0x180
V2:	WORD	$INT2, 0x180

	ORG	0x020
X:	WORD	0x030
DR3:	WORD	0
ODZ_MIN:	WORD	0xFF80
ODZ_MAX:	WORD	0x007C 

	ORG	0x030
START:	DI
	CLA
	OUT	0x0	ORG	 0x0
V0:	WORD	$DEFAULT, 0x180
V1:	WORD	$INT1, 0x180
V2:	WORD	$INT2, 0x180

	ORG	0x020
X:	WORD	0x036
DR3:	WORD	0
ODZ_MIN:	WORD	0xFF80
ODZ_MAX:	WORD	0x007C 

	ORG	0x030
START:	DI
	CLA
	OUT	0x05
	OUT	0x0B
	OUT	0x0D
	OUT	0x11
	OUT	0x15
	OUT	0x19
	OUT	0x1D

	LD	#9
	OUT	3
	LD	#0xA
	OUT	7
	EI

MAIN:	CALL	CHECK_ODZ
	LD	X
	SUB	#3
	ST	X
	JUMP	MAIN	

INT1:	PUSH	; 
	HLT
	CALL	CHECK_ODZ
	LD	X;
	ADD	X;
	ADD	X;
	SUB	#5
	SXTB
	OUT	2
	HLT
	POP
	IRET


INT2:	HLT
	CALL	CHECK_ODZ
	IN	6
	SXTB
	ST 	DR3
	ADD	DR3
	ADD 	DR3
	ADD	X
	ST	X
	HLT
	IRET

CHECK_ODZ:  	LD	X
	SXTB
	CMP	ODZ_MIN
	BLT	SET_MAX_ODZ
	CMP	ODZ_MAX
	BGE	SET_MAX_ODZ
	RET

SET_MAX_ODZ:	PUSH
		LD	ODZ_MAX	
		ST	X
		POP
		RET

DEFAULT:	PUSH
	IN	4
	IN	0x18
	IN	0x19
	IN	0x1C
	POP
	IRET
5
	OUT	0x0B
	OUT	0x0D
	OUT	0x11
	OUT	0x15
	OUT	0x19
	OUT	0x1D

	LD	#9
	OUT	3
	LD	#0xA
	OUT	7
	EI

MAIN:	CALL	CHECK_ODZ
	LD	X
	SUB	#3
	ST	X
	JUMP	MAIN	

INT1:	PUSH	; 
	CALL	CHECK_ODZ

	LD	X;
	ADD	X;
	ADD	X;
	SUB	#5
	OUT	2
	POP
	IRET


INT2:	PUSH
	CALL	CHECK_ODZ
	IN	6
	SXTB
	ST 	DR3
	ADD	DR3
	ADD 	DR3
	ADD	X
	ST	X

	POP
	IRET

CHECK_ODZ:  	LD	X
	CMP	ODZ_MIN
	BLT	SET_MAX_ODZ
	CMP	ODZ_MAX
	BGE	SET_MAX_ODZ
	RET

SET_MAX_ODZ:	PUSH
		LD	ODZ_MAX	
		ST	X
		POP
		RET

DEFAULT:	PUSH
	IN	4
	IN	0x18
	IN	0x19
	IN	0x1C
	POP
	IRET
